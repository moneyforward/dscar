description: |
  Calculate the difference between the analysis results and then evaluate the result

  Use the [junit-reports-combiner][1] command to calculate the difference

  [1]: https://www.npmjs.com/package/junit-reports-combiner
parameters:
  calculate:
    description: Specify the steps for calculating the difference
    type: steps
    default:
      - calculate
  analysis-results-path:
    description: Specify the path to save the analysis results if you need to change it
    type: string
    default: "/tmp/analysis-results"
  test-results-path:
    description: Specify the value of the path parameter in the store_test_results step if you need to change it
    type: string
    default: "/tmp/test-results"
  vcs-api-token:
    description: Specify the environment variable name where the VCS (Version Control System) API token is set.
    type: env_var_name
    default: GITHUB_TOKEN
steps:
  - combine:
      analysis-results-path: << parameters.analysis-results-path >>
  - set-analysis-result-paths:
      analysis-results-path: << parameters.analysis-results-path >>
      has-aggregated: true
  - steps: << parameters.calculate >>
  - evaluate:
      analysis-results-path: << parameters.analysis-results-path >>
      pattern: '.*/([0-9]+-|)DELTA-analysis-result\.xml$'
  - transform:
      analysis-results-path: << parameters.analysis-results-path >>
      test-results-path: << parameters.test-results-path >>
      pattern: '.*/([0-9]+-|)DELTA-analysis-result\.xml$'
  - store_test_results:
      path: << parameters.test-results-path >>
  - comment:
      analysis-results-path: << parameters.analysis-results-path >>
      pattern: '.*/([0-9]+-|)DELTA-analysis-result\.xml$'
      vcs-api-token: << parameters.vcs-api-token >>
